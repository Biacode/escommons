buildscript {
    ext {
        springVersion = '4.3.9.RELEASE'
        springBootVersion = "1.5.4.RELEASE"
        elasticSearchVersion = '5.4.0'
        javaxServletApiVersion = '3.1.0'
        javaxRsApiVersion = '2.0.1'
        slfj4ApiVersion = '1.7.25'
        log4jVersion = '2.7'
        jacksonVersion = '2.8.9'
        apacheCommonsLang3Version = '3.6'
        apacheCommonsIoVersion = '2.5'
        jsr305Version = '3.0.2'
        junitVersion = '4.12'
        easymockVersion = '3.4'
        assertJVersion = '3.8.0'
        sonarqubeVersion = '2.5'
    }
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath("org.sonarsource.scanner.gradle:sonarqube-gradle-plugin:$sonarqubeVersion")
    }
}

allprojects {

    apply plugin: 'java'
    apply plugin: 'signing'

    signing {
        sign configurations.archives
    }

    group = 'org.biacode.escommons'
    version = '1.0.0'
    sourceCompatibility = 1.8

    task javadocJar(type: Jar) {
        classifier = 'javadoc'
        from javadoc
    }

    task sourcesJar(type: Jar) {
        classifier = 'sources'
        from sourceSets.main.allSource
    }

    artifacts {
        archives javadocJar, sourcesJar
    }

    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
    }

    dependencies {
        compile "org.springframework:spring-context:$springVersion"
        compile "org.slf4j:slf4j-api:$slfj4ApiVersion"
        compile "com.fasterxml.jackson.core:jackson-core:$jacksonVersion"
        compile "com.fasterxml.jackson.core:jackson-databind:$jacksonVersion"
        compile "com.fasterxml.jackson.core:jackson-annotations:$jacksonVersion"
        compile "com.fasterxml.jackson.jaxrs:jackson-jaxrs-json-provider:$jacksonVersion"
        compile "org.apache.commons:commons-lang3:$apacheCommonsLang3Version"
        compile "commons-io:commons-io:$apacheCommonsIoVersion"
        compile "com.google.code.findbugs:jsr305:$jsr305Version"
        testCompile "junit:junit:$junitVersion"
        testCompile "org.easymock:easymock:$easymockVersion"
        testCompile "org.assertj:assertj-core:$assertJVersion"
    }
}

apply plugin: "org.sonarqube"
apply plugin: 'jacoco'

sonarqube {
    properties {
        property "sonar.sourceEncoding", "UTF-8"
        property "sonar.projectName", "escommons"
        property "sonar.projectKey", "escommons"
        property "sonar.organization", "escommons"
        property "sonar.host.url", "https://sonarcloud.io"
        property "sonar.language", "java"
        property "sonar.login", System.getenv("SONAR_TOKEN")
        property "sonar.jacoco.reportPaths", "${project.buildDir}/jacoco/test.exec"
        property "sonar.exclusions", ["**com/biacode/escommons/api/model/**", "**com/biacode/escommons/api/client/**"]
    }
}

project(':api:rest-rs') {

    apply plugin: 'maven'

    uploadArchives {
        repositories {
            mavenDeployer {
                beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }

                repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2") {
                    authentication(userName: System.getenv('NEXUS_USERNAME'), password: System.getenv('NEXUS_PASSWORD'))
                }

                snapshotRepository(url: "https://oss.sonatype.org/content/repositories/snapshots") {
                    authentication(userName: System.getenv('NEXUS_USERNAME'), password: System.getenv('NEXUS_PASSWORD'))
                }

                pom.project {
                    name 'EsCommons'
                    packaging 'jar'
                    // optionally artifactId can be defined here
                    description 'Elasticsearch commons library.'
                    url 'https://github.com/Biacode/escommons'

                    scm {
                        connection 'scm:git:git@github.com:Biacode/escommons.git'
                        developerConnection 'scm:git:ssh://github.com:Biacode/escommons.git'
                        url 'https://github.com/Biacode/escommons/tree/master'
                    }

                    licenses {
                        license {
                            name 'MIT License'
                            url 'https://opensource.org/licenses/MIT'
                        }
                    }

                    developers {
                        developer {
                            id 'biacode'
                            name 'Artur Asatryan'
                            email 'biacoder@gmail.com'
                        }
                    }
                }
            }
        }
    }

    dependencies {
        compile project(':core')
        compile project(':api:rest-model')
        compile "javax.ws.rs:javax.ws.rs-api:$javaxRsApiVersion"
        compileOnly "javax.servlet:javax.servlet-api:$javaxServletApiVersion"
        testCompile "org.glassfish.jersey.containers:jersey-container-servlet-core:2.25.1"
    }
}

project(':api:rest-boot') {

    apply plugin: 'maven'

    uploadArchives {
        repositories {
            mavenDeployer {
                beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }

                repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                snapshotRepository(url: "https://oss.sonatype.org/content/repositories/snapshots") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                pom.project {
                    name 'EsCommons'
                    packaging 'jar'
                    // optionally artifactId can be defined here
                    description 'Elasticsearch commons library.'
                    url 'https://github.com/Biacode/escommons'

                    scm {
                        connection 'scm:git:git@github.com:Biacode/escommons.git'
                        developerConnection 'scm:git:ssh://github.com:Biacode/escommons.git'
                        url 'https://github.com/Biacode/escommons/tree/master'
                    }

                    licenses {
                        license {
                            name 'MIT License'
                            url 'https://opensource.org/licenses/MIT'
                        }
                    }

                    developers {
                        developer {
                            id 'biacode'
                            name 'Artur Asatryan'
                            email 'biacoder@gmail.com'
                        }
                    }
                }
            }
        }
    }

    dependencies {
        compile project(':core')
        compile project(':api:rest-model')
        compile "org.springframework.boot:spring-boot-starter-web:$springBootVersion"
        compile "org.springframework.boot:spring-boot-starter-jersey:$springBootVersion"
    }
}

project(':api:rest-client') {

    apply plugin: 'maven'

    uploadArchives {
        repositories {
            mavenDeployer {
                beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }

                repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                snapshotRepository(url: "https://oss.sonatype.org/content/repositories/snapshots") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                pom.project {
                    name 'EsCommons'
                    packaging 'jar'
                    // optionally artifactId can be defined here
                    description 'Elasticsearch commons library.'
                    url 'https://github.com/Biacode/escommons'

                    scm {
                        connection 'scm:git:git@github.com:Biacode/escommons.git'
                        developerConnection 'scm:git:ssh://github.com:Biacode/escommons.git'
                        url 'https://github.com/Biacode/escommons/tree/master'
                    }

                    licenses {
                        license {
                            name 'MIT License'
                            url 'https://opensource.org/licenses/MIT'
                        }
                    }

                    developers {
                        developer {
                            id 'biacode'
                            name 'Artur Asatryan'
                            email 'biacoder@gmail.com'
                        }
                    }
                }
            }
        }
    }

    dependencies {
        compile project(':api:rest-model')
        compile "javax.ws.rs:javax.ws.rs-api:$javaxRsApiVersion"
    }
}

project(':core') {

    apply plugin: 'maven'

//    archivesBaseName = "custom-name"

    uploadArchives {
        repositories {
            mavenDeployer {
                beforeDeployment { MavenDeployment deployment -> signing.signPom(deployment) }

                repository(url: "https://oss.sonatype.org/service/local/staging/deploy/maven2") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                snapshotRepository(url: "https://oss.sonatype.org/content/repositories/snapshots") {
                    authentication(userName: "${System.getenv('NEXUS_USERNAME')}", password: "${System.getenv('NEXUS_PASSWORD')}")
                }

                pom.project {
                    name 'EsCommons'
                    packaging 'jar'
                    // optionally artifactId can be defined here
                    description 'Elasticsearch commons library.'
                    url 'https://github.com/Biacode/escommons'

                    scm {
                        connection 'scm:git:git@github.com:Biacode/escommons.git'
                        developerConnection 'scm:git:ssh://github.com:Biacode/escommons.git'
                        url 'https://github.com/Biacode/escommons/tree/master'
                    }

                    licenses {
                        license {
                            name 'MIT License'
                            url 'https://opensource.org/licenses/MIT'
                        }
                    }

                    developers {
                        developer {
                            id 'biacode'
                            name 'Artur Asatryan'
                            email 'biacoder@gmail.com'
                        }
                    }
                }
            }
        }
    }

    dependencies {
        compile "org.elasticsearch:elasticsearch:${elasticSearchVersion}"
        compile "org.elasticsearch.client:transport:${elasticSearchVersion}"
        compile "org.elasticsearch.plugin:transport-netty4-client:${elasticSearchVersion}"
        compile "org.apache.logging.log4j:log4j-core:${log4jVersion}"
    }
}

project(':integration-tests') {
    dependencies {
        compile project(':core')
        compile "org.elasticsearch:elasticsearch:${elasticSearchVersion}"
        compile "org.elasticsearch.client:transport:${elasticSearchVersion}"
        compile "org.elasticsearch.plugin:transport-netty4-client:${elasticSearchVersion}"
        compile "org.apache.logging.log4j:log4j-core:${log4jVersion}"
        testCompile "org.springframework:spring-test:$springVersion"
    }
}